<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=generator content="Source Themes Academic 4.8.0">
<meta name=author content="Philip Shemella">
<meta name=description content="If you didn&rsquo;t know, there are more SQLite databases in the universe ( 1+ trillion) than there are known galaxies ( 100 billion). And one of those SQLite databases happens to be your browsing history.">
<link rel=alternate hreflang=en-us href=https://smalldata.github.io/posts/browsing-stats/>
<meta name=theme-color content="#2962ff">
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/github.min.css crossorigin=anonymous title=hl-light>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/dracula.min.css crossorigin=anonymous title=hl-dark disabled>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin=anonymous>
<script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin=anonymous async></script>
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
<link rel=stylesheet href=/css/academic.css>
<link rel=manifest href=/index.webmanifest>
<link rel=icon type=image/png href=/images/icon_hu137b7eee8aa8b920cff43510025d0585_16891_32x32_fill_lanczos_center_3.png>
<link rel=apple-touch-icon type=image/png href=/images/icon_hu137b7eee8aa8b920cff43510025d0585_16891_192x192_fill_lanczos_center_3.png>
<link rel=canonical href=https://smalldata.github.io/posts/browsing-stats/>
<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@philshem">
<meta property="twitter:creator" content="@philshem">
<meta property="og:site_name" content="small DATA">
<meta property="og:url" content="https://smalldata.github.io/posts/browsing-stats/">
<meta property="og:title" content="Getting stats on browsing history from the browser database | small DATA">
<meta property="og:description" content="If you didn&rsquo;t know, there are more SQLite databases in the universe ( 1+ trillion) than there are known galaxies ( 100 billion). And one of those SQLite databases happens to be your browsing history."><meta property="og:image" content="https://smalldata.github.io/images/icon_hu137b7eee8aa8b920cff43510025d0585_16891_512x512_fill_lanczos_center_3.png">
<meta property="twitter:image" content="https://smalldata.github.io/images/icon_hu137b7eee8aa8b920cff43510025d0585_16891_512x512_fill_lanczos_center_3.png"><meta property="og:locale" content="en-us">
<meta property="article:published_time" content="2020-09-18T00:00:00+00:00">
<meta property="article:modified_time" content="2020-09-18T00:00:00+00:00">
<title>Getting stats on browsing history from the browser database | small DATA</title>
</head>
<body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents>
<script>const isSiteThemeDark=!1</script>
<script src=/js/load-theme.js></script>
<aside class=search-results id=search>
<div class=container>
<section class=search-header>
<div class="row no-gutters justify-content-between mb-3">
<div class=col-6>
<h1>Search</h1>
</div>
<div class="col-6 col-search-close">
<a class=js-search href=#><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a>
</div>
</div>
<div id=search-box>
<input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control>
</div>
</section>
<section class=section-search-results>
<div id=search-hits>
</div>
</section>
</div>
</aside>
<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main>
<div class=container>
<div class="d-none d-lg-inline-flex">
<a class=navbar-brand href=/>small DATA</a>
</div>
<button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span>
</button>
<div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
<a class=navbar-brand href=/>small DATA</a>
</div>
<div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content>
<ul class="navbar-nav d-md-inline-flex">
<li class=nav-item>
<a class=nav-link href=/#about><span>About</span></a>
</li>
<li class=nav-item>
<a class="nav-link active" href=/posts/><span>Posts</span></a>
</li>
<li class=nav-item>
<a class=nav-link href=/#contact><span>Contact</span></a>
</li>
</ul>
</div>
<ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
<li class=nav-item>
<a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a>
</li>
<li class="nav-item dropdown theme-dropdown">
<a href=# class="nav-link js-theme-selector" data-toggle=dropdown aria-haspopup=true>
<i class="fas fa-palette" aria-hidden=true></i>
</a>
<div class=dropdown-menu>
<a href=# class="dropdown-item js-set-theme-light">
<span>Light</span>
</a>
<a href=# class="dropdown-item js-set-theme-dark">
<span>Dark</span>
</a>
<a href=# class="dropdown-item js-set-theme-auto">
<span>Automatic</span>
</a>
</div>
</li>
</ul>
</div>
</nav>
<article class=article>
<div class="article-container pt-3">
<h1>Getting stats on browsing history from the browser database</h1>
<div class=article-metadata>
<span class=article-date>
18 Sep 2020
</span>
</div>
</div>
<div class=article-container>
<div class=article-style>
<p>If you didn&rsquo;t know, there are more SQLite databases in the universe (
<a href=https://www.sqlite.org/mostdeployed.html target=_blank rel=noopener>1+ trillion</a>) than there are known galaxies (
<a href=https://www.discovermagazine.com/the-sciences/how-many-galaxies-are-there-astronomers-are-revealing-the-enormity-of-the target=_blank rel=noopener>100 billion</a>). And one of those SQLite databases happens to be your browsing history. As a short proof-of-concept, here&rsquo;s how to access the history of your Firefox browser via the SQLite database.</p>
<h2 id=find-your-database-file>find your database file</h2>
<p>Mozilla Firefox stores your cookies, bookmarks, form inputs, and browsing history under the path defined in your profile settings. To find the path of those files in your file system, visit <strong>about:profiles</strong> in a Firefox window.</p>
<p>In my case, I only use really one profile, which is shown in the orange box.</p>
<p><img src=/images/firefox-profile-path.png alt="showing file system path to profile in firefox"></p>
<p>You can click &ldquo;Show in Finder&rdquo; and then scroll down to the file <code>places.sqlite</code>. Trying to directly open this database file gives the error &ldquo;locked database&rdquo; &ndash; you&rsquo;ll need to make a copy of the file in a different folder before opening.</p>
<p><img src=/images/firefox-db-locked.png alt="database is locked"></p>
<h2 id=explore-the-database>explore the database</h2>
<p>The go-to SQLite client is
<a href=https://sqlitebrowser.org/ target=_blank rel=noopener>DB Browser for SQLite</a>. Once installed, you can easily open your <code>places.sqlite</code> file with &ldquo;Open With&rdquo; from Finder.</p>
<p><img src=/images/firefox-db-openwith.png alt="opening the db file"></p>
<p>Once the database file is open, you&rsquo;ll see 13 tables</p>
<p><img src=/images/firefox-db-tables.png alt="finding the right tables"></p>
<p>After digging through a couple tables, the one with your browsing history is called <code>moz_places</code>. By viewing this table, you&rsquo;ll see that the field <code>url</code> stores the page visited, and last visit date is the UNIX timestamp of the last visit.</p>
<p><img src=/images/firefox-db-history-view.png alt="viewing the table with browsing history"></p>
<p>Sort descending by <code>visit_count</code> and you&rsquo;ll find your most commonly viewed website. For me, it&rsquo;s HackerNews, and then various permutations of Twitter. (I use the mobile Twitter site instead of the app, and I sync my history between devices.)</p>
<h2 id=query-the-database>query the database</h2>
<p>Despite using Twitter, I&rsquo;m a private person, and I don&rsquo;t want to share any real analysis of my browsing history. I do want to share one result: the distribution of <code>http://localhost</code> ports. Here&rsquo;s a short python3 script that reads the copy of the <code>place.sqlite</code> file, and returns a count of localhost ports from the browsing history.</p>
<pre><code class=language-python>import pandas as pd
import sqlite3

# connect and read database
con = sqlite3.connect('places.sqlite')
df = pd.read_sql_query('select * from moz_places', con)
con.close()

#Â filter for urls containing localhost
# notice I include ':', which means a port should be defined
df = df[df.url.str.contains('localhost:',case=False)]

# parse the url to get just the port
df.port = df.url.str.split(':').str[-1].str.split('/').str[0]

# keep only port column and do a count by grouping each port
df = df.port
df = df.groupby(df).count()

print(df.to_markdown())
</code></pre>
<p>Here&rsquo;s the results, with my annotation:</p>
<table>
<thead>
<tr>
<th style=text-align:left>port</th>
<th style=text-align:center>count</th>
<th style=text-align:left>description</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>1313</td>
<td style=text-align:center>144</td>
<td style=text-align:left>Hugo devserver - this site!</td>
</tr>
<tr>
<td style=text-align:left>3000</td>
<td style=text-align:center>41</td>
<td style=text-align:left>Metabase (?), which I tested a while ago</td>
</tr>
<tr>
<td style=text-align:left>5000</td>
<td style=text-align:center>4</td>
<td style=text-align:left>Flask web server (work stuff)</td>
</tr>
<tr>
<td style=text-align:left>50222</td>
<td style=text-align:center>1</td>
<td style=text-align:left>Callback for Tableau authentication</td>
</tr>
<tr>
<td style=text-align:left>58595</td>
<td style=text-align:center>1</td>
<td style=text-align:left>Not sure, but probably similar to 50222</td>
</tr>
<tr>
<td style=text-align:left>8000</td>
<td style=text-align:center>137</td>
<td style=text-align:left>Old faithful, in this case mkdocs (work stuff)</td>
</tr>
<tr>
<td style=text-align:left>8888</td>
<td style=text-align:center>37</td>
<td style=text-align:left>Jupyter notebook server</td>
</tr>
<tr>
<td style=text-align:left>8889</td>
<td style=text-align:center>4</td>
<td style=text-align:left>Jupyter notebook server</td>
</tr>
<tr>
<td style=text-align:left>9005</td>
<td style=text-align:center>1</td>
<td style=text-align:left>Callback for Firebase CLI authentication</td>
</tr>
<tr>
<td style=text-align:left></td>
<td style=text-align:center>7</td>
<td style=text-align:left>No port means URL had multiple <code>:</code>. See below.</td>
</tr>
</tbody>
</table>
<p>Similar aggregation could be done directly in SQL:</p>
<pre><code class=language-sql>select
   port,
   count(1) 
from
   (
      select
         url,
         replace( replace( substr(url, instr(url, 'localhost:'), 15), 'localhost:' , ''), '/', '') as port 
      from
         moz_places 
      where
         url like '%localhost:%' 
   )
group by
   port
</code></pre>
<p>which generates <em>almost</em> identical results.</p>
<p>The SQL query picked up one instance of <code>localhost:9005</code> that the Python script didn&rsquo;t find.</p>
<p>Digging deeper:</p>
<pre><code class=language-sql>select
   * 
from
   moz_places 
where
   url like '%localhost:9005%'
</code></pre>
<p>shows that port 9005 was used for the Callback on Firebase CLI authentication. The reason is because the Python script splits on the <code>:</code> character, for which this URL has more than one. The table shows 7 localhost URLs without ports, but these are actually URLs that have more than one <code>:</code> character. I&rsquo;ve updated the table above, but not the Python script.</p>
<h2 id=conclusion>conclusion</h2>
<p>Everything is a SQLite database.</p>
</div>
<div class=article-tags>
<a class="badge badge-light" href=/tag/python/>python</a>
<a class="badge badge-light" href=/tag/open-data/>open data</a>
<a class="badge badge-light" href=/tag/coding/>coding</a>
</div>
<div class=share-box aria-hidden=true>
<ul class=share>
<li>
<a href="https://twitter.com/intent/tweet?url=https://smalldata.github.io/posts/browsing-stats/&text=Getting%20stats%20on%20browsing%20history%20from%20the%20browser%20database" target=_blank rel=noopener class=share-btn-twitter>
<i class="fab fa-twitter"></i>
</a>
</li>
<li>
<a href="https://www.facebook.com/sharer.php?u=https://smalldata.github.io/posts/browsing-stats/&t=Getting%20stats%20on%20browsing%20history%20from%20the%20browser%20database" target=_blank rel=noopener class=share-btn-facebook>
<i class="fab fa-facebook"></i>
</a>
</li>
<li>
<a href="https://news.ycombinator.com/submitlink?u=https://smalldata.github.io/posts/browsing-stats/&t=Getting%20stats%20on%20browsing%20history%20from%20the%20browser%20database" target=_blank rel=noopener class=share-btn-hackernews>
<i class="fab fa-hacker-news-square"></i>
</a>
</li>
<li>
<a href="mailto:?subject=Getting%20stats%20on%20browsing%20history%20from%20the%20browser%20database&body=https://smalldata.github.io/posts/browsing-stats/" target=_blank rel=noopener class=share-btn-email>
<i class="fas fa-envelope"></i>
</a>
</li>
</ul>
</div>
<div class="media author-card content-widget-hr">
<img class="avatar mr-3 avatar-circle" src=/author/philip-shemella/avatar_hu0a1728dd5a2ac31c8d08e46a4ab7469f_33690_270x270_fill_q90_lanczos_center.jpg alt="Philip Shemella">
<div class=media-body>
<h5 class=card-title><a href=/author/philip-shemella/>Philip Shemella</a></h5>
<p class=card-text>Thanks for reading</p>
<ul class=network-icon aria-hidden=true>
<li>
<a href=mailto:philip@smalldata.dev>
<i class="fas fa-envelope"></i>
</a>
</li>
<li>
<a href=https://twitter.com/philshem target=_blank rel=noopener>
<i class="fab fa-twitter"></i>
</a>
</li>
<li>
<a href=https://github.com/philshem target=_blank rel=noopener>
<i class="fab fa-github"></i>
</a>
</li>
<li>
<a href=https://opendata.stackexchange.com/users/1511/philshem target=_blank rel=noopener>
<i class="fab fa-stack-overflow"></i>
</a>
</li>
</ul>
</div>
</div>
</div>
</article>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js integrity="sha512-7t8APmYpzEsZP7CYoA7RfMPV9Bb+PJHa9x2WiUnDXZx3XHveuyWUtvNOexhkierl5flZ3tr92dP1mMS+SGlD+A==" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/r.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin=anonymous></script>
<script>const code_highlighting=!0</script>
<script>const search_config={indexURI:"/index.json",minLength:1,threshold:.3},i18n={no_results:"No results found",placeholder:"Search...",results:"results found"},content_type={post:"Posts",project:"Projects",publication:"Publications",talk:"Talks",slides:"Slides"}</script>
<script id=search-hit-fuse-template type=text/x-template>
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script>
<script src=/js/academic.min.f6ecf7692215f2bc4850b72c8176bfa2.js></script>
<div class=container>
<footer class=site-footer>
<p class=powered-by>
</p>
<p class=powered-by>
<span class=float-right aria-hidden=true>
<a href=# class=back-to-top>
<span class=button_icon>
<i class="fas fa-chevron-up fa-2x"></i>
</span>
</a>
</span>
</p>
</footer>
</div>
<div id=modal class="modal fade" role=dialog>
<div class=modal-dialog>
<div class=modal-content>
<div class=modal-header>
<h5 class=modal-title>Cite</h5>
<button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span>
</button>
</div>
<div class=modal-body>
<pre><code class="tex hljs"></code></pre>
</div>
<div class=modal-footer>
<a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank>
<i class="fas fa-copy"></i> Copy
</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank>
<i class="fas fa-download"></i> Download
</a>
<div id=modal-error></div>
</div>
</div>
</div>
</div>
</body>
</html>